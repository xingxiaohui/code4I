# Java并发编程实践  
## 一、生产者和消费者模式  
1. 介绍  
生产者和消费者模式是通过一个容器来解决生产者和消费者的强耦合问题。生产者和消费者彼此之间不直接通信，而是通过阻塞队列来进行通信，所以生产者生产完数据之后不用等待消费者处理，直接扔给阻塞队列，消费者不找生产者要数据，而是直接从阻塞队列里取，阻塞队列就相当于一个缓冲区，平衡了生产者和消费者的处理能力。  

2. 实践示例  

3. 多生产者和多消费者场景

4. 线程池与生产消费者模式  
Java中的线程池类其实就是一种生产者和消费者模式的实现方式，但是我觉得其实现方式更加高明。生产者把任务丢给线程池，线程池创建线程并处理任务，如果将要运行的任务数大于线程池的基本线程数就把任务扔到阻塞队列里，这种做法比只使用一个阻塞队列来实现生产者和消费者模式显然要高明很多，因为消费者能够处理直接就处理掉了，这样速度更快，而生产者先存，消费者再取这种方式显然慢一些。  

## 二、线上问题定位
1. 有时候，有很多问题只有在线上或者预发环境才能发现，而线上又不能调试代码，所以线上问题定位就只能看日志、系统状态和dump线程，本节只是简单地介绍一些常用的工具，以帮助大家定位线上问题。  
1）在Linux命令行下使用TOP命令查看每个进程的情况  
2）再使用top的交互命令数字1查看每个CPU的性能数据。  
3）使用top的交互命令H查看每个线程的性能信息。
4）用jstat命令看一下GC情况，看看是不是因为持久代或年老代满了，产生Full GC，导致CPU利用率持续飙高，  
5）把线程dump下来，看看究竟是哪个线程、执行什么代码造成的CPU利用率高。  
